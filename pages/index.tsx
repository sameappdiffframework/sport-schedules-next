import type { NextPage } from 'next'
import Head from 'next/head'
import React from 'react'
import SingleDaySchedule from '../comps/single-day-schedule'
import { GetStaticProps } from 'next'
import type { Game, Schedule } from '../lib/model'
import { DateTime } from 'luxon'

const Home: NextPage<{ date: string, games: Game[] }> = ({ date, games }) => {
    return (
        <>
            <Head>
                <title>Create Next App</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            <main>
                <h1>
                    {date}
                </h1>
                <SingleDaySchedule games={games} date={new Date(date)} />
            </main>
        </>
    )
}

export const getStaticProps: GetStaticProps = async (context) => {
    // const schedule = await fetch('https://sport-schedules.netlify.app/basketball.json')
    const schedule = await fetch('http://localhost:3000/basketball.json')
        .then(response => response.json() as Promise<Schedule>)
    const groupedGames: Record<string, Game[]> = {};
    schedule.games.forEach(game => {
        const gameDate = DateTime.fromISO(game.date)
            .setZone('America/New_York')
            .startOf('day')
            .toISO();
        if (groupedGames[gameDate]) {
            groupedGames[gameDate].push(game);
        } else {
            groupedGames[gameDate] = [game];
        }
    });
    const datestring = Object.keys(groupedGames)[0];
    return {
        props: {  date: datestring, games: groupedGames[datestring]}
    }
}


export default Home
